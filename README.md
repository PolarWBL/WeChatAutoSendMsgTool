# 微信自动化消息发送工具

## 简介

该脚本通过 `uiautomation` 和其他辅助库实现了自动化控制微信客户端，支持自动发送文本消息、文件和图片。消息内容、文件路径等数据来自 Excel 文件，支持群发消息，适用于需要定期批量发送相同内容的场景。

## 功能

- **批量发送消息**：从 Excel 表格中读取多条消息信息，支持发送文本和文件（包括图片）。
- **自动控制微信**：自动定位微信窗口，选择聊天会话，发送消息。
- **文件路径处理**：支持文件拖放到剪贴板并发送，方便发送附件。
- **支持Excel读取**：从 Excel 文件中读取联系人信息、消息内容、文件路径等，自动批量发送。

## 依赖库

- `uiautomation`: 用于自动化控制 Windows 应用程序（如微信）。
- `win32clipboard`: 用于操作剪贴板，支持文件路径数据的操作。
- `keyboard`: 用于模拟键盘按键操作。
- `ctypes`: 用于定义与 Windows API 交互的数据结构。
- `openpyxl`: 用于读取 Excel 文件。

### 安装依赖

确保你已经安装了以下 Python 库：

```bash
pip install uiautomation pywin32 keyboard openpyxl
```

## 配置与使用

### 1. 微信登录

- 请确保微信客户端已经登录并处于主界面，脚本将自动控制微信进行操作。
- 当微信处于登录状态并可用时，运行该脚本，脚本会自动查找聊天框并发送消息。

### 2. Excel 文件格式

- 请准备一个 Excel 文件（默认名称：`WeChatAutoSendMsgList.xlsx`），表格需要至少有以下字段：
  - `姓名`：联系人或群聊名称
  - `消息内容`：要发送的文本内容
  - `图片/文件路径`：要发送的附件文件路径（如果没有附件可以为空）

Excel 文件内容示例如下：

| 需要搜索的姓名   | 称呼      | 正文      | 结尾      | 附件     |
| ------ | ------------- | ------------- | ------------- | ----------------- |
| 张三   | 张三 | 你好！  | 八两 | image.jpg   |
| 李四   | 李总 | 请查收文件。  | 小八 | document.pdf |

### 3. 运行脚本

- 在脚本运行时，命令行将提示你确认是否继续执行。如果微信已准备好，输入 `y` 继续。
- 该脚本将读取 Excel 文件中的数据，并依次向每个联系人发送消息。如果消息中包含文件路径，文件会被附加在消息中一起发送。

### 4. 附件发送配置

- 发送附件需要将填写附件全称（包括后缀），并将文件放在脚本和表格所在目录的'files/'目录内。
- 脚本将自动查找 `files/` 目录中的文件并发送。如果文件不存在，脚本会跳过该附件并发出警告。

## 注意事项

- **微信窗口**：脚本依赖 `uiautomation` 库定位微信窗口，确保微信窗口处于可视状态并且没有被最小化。
- **文件路径**：如果 Excel 中的文件路径指向的文件不存在，脚本会忽略该附件并发出警告。

## 常见问题

1. **如何确保微信客户端不被干扰？**

   运行脚本时，请确保微信处于主界面并且未被其他程序遮挡。可以通过调整微信窗口的位置或最小化其他应用来确保微信可用。

2. **Excel 附件无法发送怎么办？**

   请确保 Excel 附件的名称正确，特别强调需要包含文件后缀，如果文件路径无效或文件不存在，脚本将发出警告并跳过该文件的发送。

## 结语

该工具可以大大简化微信群发消息的操作，尤其是在需要批量发送文件和文本消息时。如果有其他需求或建议，欢迎提交问题反馈。
